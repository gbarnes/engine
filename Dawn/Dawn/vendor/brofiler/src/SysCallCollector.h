#pragma once
#include <MTTypes.h>

#include "Brofiler.h"
#include "MemoryPool.h"
#include "Serialization.h"


namespace Brofiler
{
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	struct SysCallDesc
	{
		int64_t timestamp;
		uint64 id;
	};
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	OutputDataStream &operator << (OutputDataStream &stream, const SysCallDesc &ob);
	//////////////////////////////////////////////////////////////////////////
	class SysCallCollector
	{
		// Packed syscall events: {timestamp, id}
		typedef MemoryPool<SysCallDesc, 1024 * 32> SysCallPool;
		SysCallPool syscallPool;
	public:
		void Add(const SysCallDesc& desc);
		void Clear();

		bool Serialize(OutputDataStream& stream);
	};
	//////////////////////////////////////////////////////////////////////////
}